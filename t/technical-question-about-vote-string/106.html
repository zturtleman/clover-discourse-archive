<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from forum.clover.moe/t/technical-question-about-vote-string/106 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 Aug 2018 19:53:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Technical question about VOTE string - id Tech 3 - Magical Clover Forum</title>
    <meta name="description" content="Hello everyone who read this! 

My question is concerning something I consider as a bug in idtech3, though I&amp;#39;m not 100% sure if it is a bug at all! 

THE (possible) BUG: In some specific situations the VOTE string (most &amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 2.1.0.beta4 - https://github.com/discourse/discourse version 94622b451a19f0f5152280f146354ab663d06eb8">
<link rel="icon" type="image/png" href="../../uploads/default/original/1X/8d64303f6f94740f94b6a460adfb8b936d6fdb65.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/original/1X/e0bc53086df7471db874a7d0c70ce1d2d653b278.png">
<link rel="icon" type="image/png" sizes="144x144" href="../../uploads/default/original/1X/e0bc53086df7471db874a7d0c70ce1d2d653b278.png">
<meta name="theme-color" content="#bbeebb">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="106.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.clover.moe","potentialAction":{"@type":"SearchAction","target":"https://forum.clover.moe/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Magical Clover Forum Search">

      <link href="../../stylesheets/desktop_1_bdd11c5ff6b465c06e9ec1c7b16931ccf4884ce93b43.css?__ws=forum.clover.moe" media="all" rel="stylesheet" data-target="desktop" data-theme-id="1"/>
      <link href="../../stylesheets/desktop_theme_1_e42a03b7f95c4cdf2569b14817761786616cb9de3b43.css?__ws=forum.clover.moe" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="1"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Technical question about VOTE string&#39;" href="106.rss" />
  <meta property="og:site_name" content="Magical Clover Forum" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.clover.moe/uploads/default/original/1X/e0bc53086df7471db874a7d0c70ce1d2d653b278.png" />
<meta property="og:image" content="https://forum.clover.moe/uploads/default/original/1X/e0bc53086df7471db874a7d0c70ce1d2d653b278.png" />
<meta property="og:url" content="https://forum.clover.moe/t/technical-question-about-vote-string/106" />
<meta name="twitter:url" content="https://forum.clover.moe/t/technical-question-about-vote-string/106" />
<meta property="og:title" content="Technical question about VOTE string" />
<meta name="twitter:title" content="Technical question about VOTE string" />
<meta property="og:description" content="Hello everyone who read this!  My question is concerning something I consider as a bug in idtech3, though I‚Äôm not 100% sure if it is a bug at all!  THE (possible) BUG:  In some specific situations the VOTE string (most notably with Team Arena mod) don‚Äôt vanish. The text/string will stay on screen until a new map restart. This happens if more than one vote is called. For example you vote for a new map, and realize you voted for the wrong map and will vote again for the correct map you was looking..." />
<meta name="twitter:description" content="Hello everyone who read this!  My question is concerning something I consider as a bug in idtech3, though I‚Äôm not 100% sure if it is a bug at all!  THE (possible) BUG:  In some specific situations the VOTE string (most notably with Team Arena mod) don‚Äôt vanish. The text/string will stay on screen until a new map restart. This happens if more than one vote is called. For example you vote for a new map, and realize you voted for the wrong map and will vote again for the correct map you was looking..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ‚ù§" />
<meta property="article:published_time" content="2017-03-29T18:18:30+00:00" />
<meta property="og:ignore_canonical" content="true" />


  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html"><img src="../../uploads/default/original/1X/e0fba8786bf072fa9d149ae89abf88bdac001685.png" alt="Magical Clover Forum" id="site-logo" style="max-width: 150px;"></a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="106.html">Technical question about VOTE string</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/id-tech-3.html" itemprop="url">
        <span itemprop="title">id Tech 3</span>
      </a>
    </div>
</div>





<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='https://forum.clover.moe/u/KuehnhammerTobias'><b itemprop='author'>KuehnhammerTobias</b></a>
           
           <time datetime='2017-03-29T18:18:30Z' itemprop='datePublished'>
             2017-03-29 18:18:30 UTC
           </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hello everyone who read this!</p>
<p>My question is concerning something I consider as a bug in idtech3, though I‚Äôm not 100% sure if it is a bug at all!</p>
<p><strong>THE</strong> (possible) <strong>BUG:</strong><br>
In some specific situations the VOTE string (most notably with Team Arena mod) don‚Äôt vanish. The text/string will stay on screen until a new map restart. This happens if more than one vote is called. For example you vote for a new map, and realize you voted for the wrong map and will vote again for the correct map you was looking for.<br>
It seems as if the vote commands are added in a vote queue, but I never saw that the vote system is working like this, maybe I missed something here‚Ä¶</p>
<p><strong>HOW TO REPRODUCE:</strong></p>
<ol>
<li>Start Team Arena mod (either via Spearmint or ioquake3).</li>
<li>Start any map e.g.: q3dm1.</li>
<li>Now open the VOTE menu and vote for a new/different map (e.g.: q3dm2).</li>
<li>The menu will close, immediatly before the new map will restart bring down the VOTE menu again and vote for another different map (e.g.: q3dm3).</li>
<li>Now the first map voted for will start and the Vote string: <em>Vote: Yes: 0, No: 0. Press F1 to vote for Yes or F2 to vote for No (or press ESC then click Vote).</em> will appear on screen.</li>
<li>No matter what you do, the vote string will not disappear, as long as a new map restart will happen.</li>
</ol>
<p>Now my <strong>QUESTIONS</strong> are:<br>
A: Is this a common idtech3 bug, or is this behaviour intentionally?<br>
B: Personally I find this behaviour annoying, does someone know how to fix this, even if it isn‚Äôt a bug at all?</p>
<p>All suggestions and every information is welcome!<br>
Thank you!</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Technical question about VOTE string'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='https://forum.clover.moe/u/zturtleman'><b itemprop='author'>zturtleman</b></a>
           
           <time datetime='2017-03-31T15:36:00Z' itemprop='datePublished'>
             2017-03-31 15:36:00 UTC
           </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Work around: CGame doesn‚Äôt check for vote configstrings when it starts (which is a bug) so running <code>vid_restart</code> will stop drawing the vote string. <img src="../../images/emoji/twitter/sunglassesae52.png?v=5" title=":sunglasses:" class="emoji" alt=":sunglasses:"></p>
<hr>
<p>What you describe is a bug. When the second <code>callvote</code> happens Cmd_CallVote_f() sees that there was a vote that hasn‚Äôt been executed yet. The vote string is added to the command buffer so it‚Äôs executed when the server runs Cbuf_Execute().</p>
<pre><code class="lang-auto">Cmd_CallVote_f()

	// if there is still a vote to be executed
	if ( level.voteExecuteTime ) {
		level.voteExecuteTime = 0;
		trap_SendConsoleCommand( EXEC_APPEND, va("%s\n", level.voteString ) );
	}
</code></pre>
<p>Then Cmd_CallVote_f() sets up the new vote which adds pending reliable ‚Äúcs‚Äù commands with the vote configstring changes. The server runs Cbuf_Execute() and changes map and clears configstrings. The client reliable commands still have ‚Äúcs‚Äù commands. The next snapshot will contain the map change and the configstrings changes (‚Äúcs‚Äù reliable commands) from <em>before</em> the map change resulting in the client having different configstrings than the server!</p>
<p>So the client has configstrings not set on the server and display the message for a vote that does not exist on the server.</p>
<p>Running <code>configstrings; vid_restart; configstrings</code>; first list has the vote strings but second list does not because server does not have them set.</p>
<hr>
<p>The simplest solution is probably to drop call vote when already voted to change maps.</p>
<pre><code class="lang-auto">Cmd_CallVote_f()

	// if there is still a vote to be executed
	if ( level.voteExecuteTime ) {
		// don't start a vote when map change or restart is in progress
		if ( !Q_stricmpn( level.voteString, "map", 3 )
			|| !Q_stricmpn( level.voteString, "nextmap ", 7 ) ) {
			trap_SendServerCommand( ent-g_entities, "print \"Vote after map change.\n\"" );
			return;
		}

		level.voteExecuteTime = 0;
		trap_SendConsoleCommand( EXEC_APPEND, va("%s\n", level.voteString ) );
	}
</code></pre>
<p>Alternatively the game VM could handle carrying the vote across map change. Though, CGame always disables vote string when map_restart happens and CGame doesn‚Äôt check for vote on start up. So unless CGame is changed, carrying the call vote across map change/restart seems like a bad idea.</p>
<p>This could be solved by fixing the issue where clients have different configstrings than the server. However, then callvote just forces map change and the vote disappears so it doesn‚Äôt really serve a purpose. It‚Äôs probably still a good idea to ignore callvote after voted for map change.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Technical question about VOTE string'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='https://forum.clover.moe/u/KuehnhammerTobias'><b itemprop='author'>KuehnhammerTobias</b></a>
           
           <time datetime='2017-03-31T18:10:52Z' itemprop='datePublished'>
             2017-03-31 18:10:52 UTC
           </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you very much zturtleman!</p>
<p>The solution you suggested works fine!<br>
Code is applied and credit is given to you on my personal Spearmint project!<br>
Probably useful for all Spearmint mods and even ioquake3!<br>
Anyways,‚Ä¶</p>
<p>Thanks a lot! <img src="../../images/emoji/twitter/%2b1ae52.png?v=5" title=":+1:" class="emoji" alt=":+1:"></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='Technical question about VOTE string'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='../../index.html'>Home</a>
        <a href="../../categories.html">Categories</a>
        <a href="../../guidelines.html">FAQ/Guidelines</a>
        <a href="../../tos.html">Terms of Service</a>
        <a href="../../privacy.html">Privacy Policy</a>
      </nav>
      <p>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.clover.moe/t/technical-question-about-vote-string/106 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 Aug 2018 19:53:21 GMT -->
</html>
